import { cn } from "@/lib/utils";
import type { TimeSlot } from "@shared/schema";

interface TimeSlotGridProps {
  slots: TimeSlot[];
  selectedSlotId: string | null;
  onSelectSlot: (slot: TimeSlot) => void;
}

export function TimeSlotGrid({ slots, selectedSlotId, onSelectSlot }: TimeSlotGridProps) {
  const morningSlots = slots.filter((s) => s.period === "morning");
  const afternoonSlots = slots.filter((s) => s.period === "afternoon");
  const eveningSlots = slots.filter((s) => s.period === "evening");

  const renderSlots = (periodSlots: TimeSlot[], period: string) => {
    if (periodSlots.length === 0) return null;

    const periodConfig = {
      morning: {
        label: "Morning",
        sublabel: "6:00 AM - 12:00 PM",
        bgClass: "bg-card",
      },
      afternoon: {
        label: "Afternoon",
        sublabel: "12:00 PM - 6:00 PM",
        bgClass: "bg-primary/5",
      },
      evening: {
        label: "Evening",
        sublabel: "6:00 PM - 11:00 PM",
        bgClass: "bg-secondary",
      },
    };

    const config = periodConfig[period as keyof typeof periodConfig];

    return (
      <div className="space-y-3" data-testid={`slots-${period}`}>
        <div className="flex items-center justify-between">
          <div>
            <h4 className="font-semibold text-foreground">{config.label}</h4>
            <p className="text-xs text-muted-foreground">{config.sublabel}</p>
          </div>
          {period === "evening" && (
            <span className="text-xs text-primary font-medium">Premium</span>
          )}
        </div>
        
        <div className="grid grid-cols-3 gap-2">
          {periodSlots.map((slot) => {
            const isSelected = selectedSlotId === slot.id;
            const isBooked = slot.isBooked;
            
            return (
              <button
                key={slot.id}
                onClick={() => !isBooked && onSelectSlot(slot)}
                disabled={isBooked}
                className={cn(
                  "relative p-3 rounded-lg text-center transition-all duration-200",
                  config.bgClass,
                  isBooked && "opacity-40 cursor-not-allowed",
                  !isBooked && !isSelected && "hover-elevate cursor-pointer",
                  isSelected && "ring-2 ring-primary bg-primary/20"
                )}
                data-testid={`slot-${slot.id}`}
              >
                <div className={cn(
                  "text-sm font-medium",
                  isSelected ? "text-primary" : "text-foreground"
                )}>
                  {slot.startTime}
                </div>
                <div className={cn(
                  "text-base font-bold mt-1",
                  isSelected ? "text-primary" : "text-foreground"
                )}>
                  â‚¹{slot.price}
                </div>
                {isBooked && (
                  <div className="absolute inset-0 flex items-center justify-center">
                    <span className="text-xs text-muted-foreground font-medium">Booked</span>
                  </div>
                )}
                {isSelected && (
                  <div className="absolute -top-1 -right-1 w-4 h-4 bg-primary rounded-full flex items-center justify-center">
                    <svg className="w-2.5 h-2.5 text-primary-foreground" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M5 13l4 4L19 7" />
                    </svg>
                  </div>
                )}
              </button>
            );
          })}
        </div>
      </div>
    );
  };

  return (
    <div className="space-y-6">
      {renderSlots(morningSlots, "morning")}
      {renderSlots(afternoonSlots, "afternoon")}
      {renderSlots(eveningSlots, "evening")}
    </div>
  );
}
